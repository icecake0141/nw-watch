# Web UI スクリーンショットガイド

このガイドでは、Network Watch Webインターフェースの各機能とコンポーネントの詳細な説明とともに、ビジュアルドキュメントを提供します。

![Web UI Overview](images/webui-overview.png)

## インターフェース概要

Network Watch Webインターフェースは、リアルタイムのネットワークデバイス監視データを表示するシングルページアプリケーションです。インターフェースはいくつかの主要なセクションに分かれています:

1. **自動更新コントロール付きヘッダー**
2. **デバイス接続パネル**
3. **コマンド出力タブ**
4. **実行履歴表示**
5. **差分ビューア**

---

## 1. ヘッダーとコントロール

ページ上部に配置され、アプリケーションのブランディングと更新コントロールを提供します。

### コンポーネント:
- **タイトル**: "Network Watch - Dual Device Monitor"
- **⏸ Pause Auto-Refresh ボタン**: 
  - バックエンドからのデータの自動ポーリングを切り替え
  - 一時停止時は "▶ Resume Auto-Refresh" に変更
  - 一時停止時、自動更新が無効であることを示すバナーが表示されます
- **🔄 Refresh Now ボタン**: 
  - 手動で即座にデータ更新をトリガー
  - 自動更新状態とは独立して動作
  - 自動更新が一時停止中のオンデマンド更新に便利

### 使用方法:
トラブルシューティング中は「Pause Auto-Refresh」をクリックして表示を固定し、その後「Refresh Now」を使用して自分のペースでデータを更新できます。

---

## 2. デバイス接続パネル

このパネルは、設定されたすべてのデバイスのリアルタイムping監視を提供し、60秒間の接続状態を表示します。

### 表示情報:

各デバイスについて、以下が表示されます:

- **デバイス名**: 設定されたデバイス識別子
- **ステータスインジケーター**: 
  - 🟢 緑: デバイスに到達可能（成功率≥50%）
  - 🔴 赤: デバイスがダウン（成功率<50%）
  - ⚪ 灰色: ステータス不明（pingデータなし）
- **成功率**: ウィンドウ内の成功したpingの割合（例: "95.0%"）
- **サンプル数**: 成功対合計サンプル数（例: "57/60"）
- **平均RTT**: 平均往復時間（ミリ秒単位、例: "12.5 ms"）
- **最終チェック**: 最新のpingのタイムスタンプ（JST表示）
- **タイムライン**: カラーコード付きタイルによる60秒の可視化:
  - 🟩 緑タイル: ping成功
  - 🟥 赤タイル: ping失敗
  - ⬜ 灰タイル: その秒のデータなし
  - タイムラインは左（古い）から右（新しい）へ流れる

### 解釈:
- 一貫した緑のタイムラインは安定した接続を示す
- 断続的な赤タイルはネットワークの不安定性を示唆
- 完全な赤タイムラインはデバイスが到達不能であることを示す
- 開始時の灰タイルは新たに起動されたコレクターでは正常

---

## 3. コマンド出力タブ

コマンドはタブに整理され、システムで設定された一意のコマンドごとに1つのタブがあります。

### 機能:
- **タブ整理**: 各タブにコマンドテキストでラベル付け（例: "show version"、"show interfaces status"）
- **タブ順序**: 設定ファイルの`sort_order`で制御
- **アクティブタブのハイライト**: 現在選択されているタブが視覚的に区別される
- **クリックして切り替え**: 任意のタブをクリックして、そのコマンドのすべてのデバイス間での出力を表示

### タブの例:
- `show version` - デバイスのソフトウェアとハードウェア情報
- `show interfaces status` - インターフェースの動作状態
- `show ip interface brief` - IPアドレス設定の概要

---

## 4. 実行履歴表示

各コマンドタブ内では、デバイスごとに完全な実行履歴と共に出力が表示されます。

### 表示構造:

各デバイスセクションには以下が表示されます:

**デバイスヘッダー**: 太字のデバイス名

**実行エントリ**（新しい順）:
各実行エントリには以下が表示されます:

- **タイムスタンプ**: JST実行時刻（例: "2024-01-09 21:15:30"）
- **実行時間バッジ**: 実行時間（ミリ秒単位、例: "234 ms"）
- **ステータスバッジ**:
  - ✅ 成功: コマンドが正常に完了
  - ❌ エラー: コマンドが失敗（エラーメッセージを表示）
- **フィルターバッジ**: 🔍 フィルター済み - 出力が除外パターンに一致（デフォルトで非表示）
- **トリミングバッジ**: ✂️ トリミング済み - 出力が最大行制限を超過
- **行数**: 元の行数と表示行数を表示（例: "元: 150行 → 表示: 100行"）

**出力表示**:
- 実行ヘッダーをクリックして出力を展開/折りたたみ
- 読みやすさのため等幅フォントで出力を表示
- 元の書式と空白を保持
- エラーメッセージは赤テキストで表示

---

## 5. 差分ビュー

インターフェースは、ネットワークデバイスの状態変化を識別するための2種類の差分比較を提供します。

### 5.1 履歴差分（前回 vs 最新）

同じデバイスとコマンドの最新2回の実行を比較します。

**機能**:
- **ボタン**: "Show Previous vs Latest"（≥2回の実行が存在する場合に表示）
- **比較ラベル**: 
  - 左列: "Previous"（古い実行とタイムスタンプ）
  - 右列: "Latest"（新しい実行とタイムスタンプ）
- **カラーコーディング**:
  - 🟩 緑背景: 最新実行で追加された行
  - 🟥 赤背景: 前回実行から削除された行
  - 🟨 黄背景: 差分ハンクヘッダー（行番号）
  - 白背景: 変更されていないコンテキスト行

**ユースケース**:
- 設定変更の検出
- 新規または削除されたインターフェースの識別
- バージョン更新の追跡
- ルーティングテーブルの変更の監視

### 5.2 デバイス間差分（デバイスA vs デバイスB）

同じコマンドの2つの異なるデバイス間の出力を比較します。

**機能**:
- **ボタン**: デバイス選択ドロップダウン付きの "Show Device Diff"
- **デバイス選択**: 比較する2つのデバイスを選択
- **比較ラベル**: 列ヘッダーとしてデバイス名を表示
- **同じカラーコーディング**: 緑（追加）、赤（削除）、黄（ヘッダー）

**ユースケース**:
- デバイス間の設定一貫性の確認
- 冗長セットアップでの不一致の識別
- アクティブ/スタンバイデバイスの状態比較
- 設定標準コンプライアンスの監査

### 差分表示形式:

両方の差分タイプは並列HTMLテーブル形式を使用:
- **2列レイアウト**: 左右の比較
- **行番号**: 各列に表示
- **同期スクロール**: 対応する行が水平方向に整列
- **完全な出力**: 完全な差分を表示（トリミングされない）
- **空の差分**: 出力が同一の場合、"Outputs are identical"というメッセージを表示

---

## 技術詳細

### 自動更新の動作

インターフェースは異なる間隔で2つのエンドポイントをポーリングします:

- **コマンド実行**: `max(1, floor(interval_seconds/2))` 秒ごとに`/api/runs/{command}`をポーリング
- **Pingステータス**: `ping_interval_seconds` 秒ごとに`/api/ping`をポーリング

両方の間隔は`config.yaml`で設定され、フロントエンドが`/api/config`経由で自動的に取得します。

### タイムゾーン表示

- すべてのタイムスタンプはUTCエポック秒としてデータベースに保存
- フロントエンドは表示用にJST（UTC+9）に変換
- 変換はJavaScriptの`Date`オブジェクトを使用してクライアント側で実行

### データの鮮度

- "Last Check"タイムスタンプは、データが最後に収集された時刻を示す
- コレクターが停止している場合、古いデータが発生する可能性がある
- タイムスタンプが更新されなくなった場合はコレクターのログを確認

---

## ナビゲーションのヒント

1. **クイックステータスチェック**: デバイス接続パネルで全体的な健全性を一目で確認
2. **問題の調査**: pingパネルで失敗したデバイスをクリック → コマンドタブでエラー詳細を確認
3. **変更の追跡**: "Previous vs Latest"差分を使用して前回実行以降の変更を確認
4. **一貫性の確認**: "Device Diff"を使用してデバイス間の設定を比較
5. **表示の固定**: 複雑な出力を分析する際は自動更新を一時停止
6. **強制更新**: "Refresh Now"を使用して最新データを即座に取得

---

## レスポンシブデザイン

インターフェースはデスクトップ表示に最適化されていますが、異なる画面サイズに適応します:
- 狭い画面ではタブが折り返される
- 差分テーブルは水平スクロールを提供
- pingタイムラインタイルは利用可能な幅に合わせてスケール

---

## 関連ドキュメント

- **英語版 README**: [README.md](../README.md)
- **日本語版 README**: [README.ja.md](../README.ja.md)
- **設定ガイド**: READMEファイルの「設定」セクションを参照
- **API ドキュメント**: `/docs`エンドポイントでFastAPI自動生成ドキュメント
